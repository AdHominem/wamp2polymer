<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<div id="visualisation"></div>

</body>

<!DOCTYPE html>
<svg width="960" height="500"></svg>
<script src="autobahn.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
<script>

    // Scrollbar


    //https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js

    function LineChart(payload){
        console.log(payload);

        var lineData = [{
            'x': 1,
            'y': 5
        }, {
            'x': 20,
            'y': 20
        }, {
            'x': 40,
            'y': 10
        }, {
            'x': 60,
            'y': 40
        }, {
            'x': 80,
            'y': 5
        }, {
            'x': 100,
            'y': 60
        }];

        var lineData2 = [{
            'x': 1,
            'y': 7
        }, {
            'x': 20,
            'y': 40
        }, {
            'x': 40,
            'y': 20
        }, {
            'x': 60,
            'y': 10
        }, {
            'x': 80,
            'y': 25
        }, {
            'x': 100,
            'y': 50
        }];

        var vis = d3.select("#visualisation"),
            WIDTH = 1000,
            HEIGHT = 500,
            MARGINS = {
                top: 20,
                right: 20,
                bottom: 20,
                left: 50
            };

        vis.append("rect")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("fill", "#444444");

        var xRange = d3.scale.linear()
            .range([MARGINS.left, WIDTH - MARGINS.right])
            .domain([d3.min(lineData, (d) =>d.x),d3.max(lineData,(d) => d.x)])

        var yRange = d3.scale.linear()
            .range([HEIGHT - MARGINS.top, MARGINS.bottom])
            .domain([d3.min(lineData, (d) => d.y),d3.max(lineData, (d) => d.y)])

        var lineFunc = d3.svg.line()
            .x((d) => xRange(d.x))
            .y((d) => yRange(d.y))
            .interpolate('basis');

        vis.append("svg:path")
            .attr("d", lineFunc(lineData))
            .attr("stroke", "orange")
            .attr("stroke-width", 3)
            .attr("fill", "none");

        vis.append("svg:path")
            .attr("d", lineFunc(lineData2))
            .attr("stroke", "grey")
            .attr("stroke-width", 3)
            .attr("fill", "none");
    }

    const service_name = 'linechart-comp';

    wampConnection = new autobahn.Connection({
        url: 'ws://192.168.40.122:8080/ws',
        realm: "realm1",
        authextra: {service_name: service_name}
    });
    wampConnection.open();

    const rpc = 'aggregator.frontend.car_score_history';

    wampConnection.onopen = (session) => {
        this.current_session = session;
        console.log("Connection " + service_name + " session open");
        session.call(rpc).then(
            (payload) => {
                LineChart(payload);
                console.log("subscribed to prefix: " + rpc);
            },
            (err) => {
                console.log("failed to subscribe: " + rpc + " ->" + err);
            });
    };



</script>
</html>